name: Android Deploy

on: 
  push:
    branches: [ main ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v2

      - name: Set up JDK 8.x
        uses: actions/setup-java@v1
        with:
          java-version: '8.x'

      - name: Notify result to Slack
        uses: 8398a7/action-slack@v3
        with:
          status: custom
          custom_payload: | 
            {
              attachments: [{
                color: '${{ job.status }}' === 'success' ? 'good' : '${{ job.status }}' === 'failure' ? 'danger' : 'warning',
                pretext: '${{ job.status }}' === 'success' ? 'CI が成功したみたい :tada:' : 'CI が失敗したみたい... :sweat_drops:',
                fields: [
                  {
                    title: 'repo',
                    value: `${process.env.AS_REPO}`,
                    short: true
                  },
                  {
                    title: 'author',
                    value: `${process.env.AS_AUTHOR}`,
                    short: true
                  },
                  {
                    title: 'commit',
                    value: `${process.env.AS_COMMIT}`,
                    short: true
                  },
                  {
                    title: 'job',
                    value: `${process.env.AS_JOB}`,
                    short: true
                  }
                ],
                footer: `JOB TOOK ${process.env.AS_TOOK}`
              }]
            }
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        if: always() # Pick up events even if the job fails or is canceled.